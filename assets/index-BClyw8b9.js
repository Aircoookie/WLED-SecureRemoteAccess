(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function r(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(t){if(t.ep)return;t.ep=!0;const o=r(t);fetch(t.href,o)}})();var d;async function u(){var e=document.getElementById("password").value;const n=new TextEncoder().encode(e),r=new TextEncoder().encode("testsalt");var i=+document.getElementById("iterations").value;d=await w(n,r,i)}async function w(e,n,r){var i=performance.now();const t=await crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveKey"]);var o={name:"PBKDF2",salt:n,iterations:r,hash:"SHA-256"},s={name:"HMAC",hash:"SHA-256",length:256};const c=await crypto.subtle.deriveKey(o,t,s,!0,["sign","verify"]);return crypto.subtle.exportKey("raw",c).then(function(f){var y=Array.from(new Uint8Array(f)).map(function(p){return("0"+(p&255).toString(16)).slice(-2)}).join(""),h=performance.now();document.getElementById("info").textContent="Hashing with "+r+" iterations took "+(h-i)+" ms",document.getElementById("hash").textContent=y}),c}async function v(e,n){var r=performance.now();const i=new TextEncoder().encode(e),t=await crypto.subtle.sign("HMAC",n,i);var o=Array.from(new Uint8Array(t)).map(function(c){return("0"+(c&255).toString(16)).slice(-2)}).join(""),s=performance.now();return document.getElementById("hmacInfo").textContent="HMAC generation took "+(s-r)+" ms",document.getElementById("hmac").textContent=o,o}async function m(e){if(e||(e=document.getElementById("message").value),!d)throw new Error("Please hash the password first");return v(e,d)}var l=0,g="00";function I(){return l++,l}function B(){return g}function E(e){g=e}function S(e){console.log(`Received message: ${e.data}`),console.log(`origin: ${e.origin}`);try{var n=JSON.parse(e.data)}catch(r){console.log(`Error parsing JSON: ${r}`);return}n["wled-ui"]==="onload"?e.source.postMessage('{"wled-rc":"ready"}',{targetOrigin:e.origin}):n["wled-ui"]==="sid"?E(n.sid):n["wled-ui"]==="hmac-req"&&(n.msg.nc={sid:B(),c:I()},m(JSON.stringify(n.msg)).then(r=>{var i={"wled-rc":"hmac",msg:n.msg,mac:r};e.source.postMessage(JSON.stringify(i),{targetOrigin:e.origin})}))}let C=document.querySelector("#hostInput");async function O(){document.getElementById("connectionInfo").textContent="Connecting...",await u();let e="http://"+C.value;try{new URL(e)}catch{document.getElementById("connectionInfo").textContent="Invalid URL";return}window.open(e,"wled-ui")?document.getElementById("connectionInfo").innerHTML="&#10004; Opened UI tab":document.getElementById("connectionInfo").textContent="Failed to open window"}let x=document.querySelector("#hashButton");x.addEventListener("click",()=>u());let A=document.querySelector("#hmacButton");A.addEventListener("click",()=>m());let K=document.querySelector("#connectButton");K.addEventListener("click",()=>O());let a=document.querySelector("#testingToggle");a.addEventListener("click",()=>{let e=document.getElementById("testingDiv");e.style.display!="block"?(e.style.display="block",a.textContent="Hide testing controls"):(e.style.display="none",a.textContent="Show testing controls")});onmessage=e=>{S(e)};
